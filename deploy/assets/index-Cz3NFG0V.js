import{I as b,r as m,o as k,v as M,f as A,j,k as e,l as _,D as B,x as u,A as p,K as P,C as E}from"./index-BfEDlx2e.js";import{b as C,_ as S,a as L}from"./pagination-page-BpupLFiI.js";import{_ as z}from"./button-primary-outline-DA8sDgzx.js";const x={config_authen(){return{"Content-Type":"application/json",headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}}},async search(d,t){await b.post("/user/search",d,this.config_authen()).then(o=>{t(o.data)}).catch(o=>{t(o.response.data)})},async create(d,t){await b.post("/user",d,this.config_authen()).then(o=>{t(o.data)}).catch(o=>{t(o.response.data)})},async update(d,t,o){await b.patch(`/user/${t}`,d,this.config_authen()).then(c=>{o(c.data)}).catch(c=>{o(c.response.data)})},async delete(d,t){await b.delete(`/user/${d}`,this.config_authen()).then(o=>{t(o.data)}).catch(o=>{t(o.response.data)})}},O={class:"flex md:justify-center"},T={class:"sm:w-1/1 md:w-2/3 flex flex-col mb-10 space-y-10"},F={class:"flex justify-between"},H=e("div",{class:"flex space-x-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24"},[e("path",{fill:"#A2422C",d:"M12 2a5 5 0 1 1-5 5l.005-.217A5 5 0 0 1 12 2m2 12a5 5 0 0 1 5 5v1a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-1a5 5 0 0 1 5-5z"})]),e("span",{class:"text-2xl font-bold text-red-800"},"กำหนดข้อมูลผู้ใช้งาน")],-1),K={class:"flex space-x-3"},R={class:"rounded-xl mb-10 overflow-auto"},q={class:"flex justify-end py-5"},G={id:"modal-employee",class:"modal"},J={class:"modal-box w-11/12 max-w-3xl"},Q={class:"font-bold text-lg"},W=e("hr",{class:"mt-2",style:{border:"1px solid #c2796a"}},null,-1),X={class:"py-4 flex flex-wrap"},Y={class:"basis-1/5 px-3 space-y-2 mb-3"},Z=e("label",{class:"font-semibold"},"รหัสผู้ใช้งาน",-1),ee=e("br",null,null,-1),se={class:"basis-2/5 px-3 space-y-2 mb-3"},ae=e("label",{class:"font-semibold"},"ชื่อ",-1),le=e("br",null,null,-1),te={class:"basis-2/5 px-3 space-y-2 mb-3"},oe=e("label",{class:"font-semibold"},"สกุล",-1),ne=e("br",null,null,-1),ie={class:"basis-2/6 px-3 space-y-2 mb-3"},de=e("label",{class:"font-semibold"},"ชื่อผู้ใช้",-1),ue=e("br",null,null,-1),re={class:"basis-2/6 px-3 space-y-2 mb-3"},ce=e("label",{class:"font-semibold"},"รหัสผ่าน",-1),me=e("br",null,null,-1),_e={class:"basis-2/6 px-3 space-y-2 mb-3"},pe=e("label",{class:"font-semibold"},"ยืนยันรหัสผ่าน",-1),ve=e("br",null,null,-1),fe={class:"basis-1/2 px-3 space-y-2 mb-3"},be=e("label",{class:"font-semibold"},"สิทธิ์การใช้งานระบบ",-1),he=e("br",null,null,-1),ye={class:"flex flex-col space-y-2"},we={class:"flex space-x-3"},xe=e("label",{class:"font-semibold"},"ผู้ดูแลระบบ",-1),ge={class:"flex space-x-3"},Ne=e("label",{class:"font-semibold"},"ผู้ใช้งาน",-1),Me={class:"modal-action"},Ie={__name:"index",setup(d){const t=m({page:1,limit:5,totalPage:0}),o=[{field:"employeeID",label:"รหัสพนักงาน",width:"10%"},{field:"firstName",label:"ชื่อ",width:"20%"},{field:"lastName",label:"สกุล",width:"20%"},{field:"username",label:"ชื่อผู้ใช้",width:"20%"},{field:"role",label:"สิทธิ์",width:"30%"}],c=m([]),i=m({status:!1,title:"",body:""}),s=m({in_employeeID:"",in_username:"",in_password:"",in_confirmPassword:"",in_firstName:"",in_lastName:"",in_role:"ผู้ดูแลระบบ"}),v=m("add"),r=m(null),g=()=>{s.value={in_employeeID:"",in_username:"",in_password:"",in_confirmPassword:"",in_firstName:"",in_lastName:"",in_role:"ผู้ดูแลระบบ"}},D=n=>{r.value=n,N("edit")},N=n=>{v.value=n,n==="add"?g():s.value={in_employeeID:r.value.employeeID,in_username:r.value.username,in_firstName:r.value.firstName,in_lastName:r.value.lastName,in_role:r.value.role},document.getElementById("modal-employee").showModal()},I=()=>{if(s.value.in_password===s.value.in_confirmPassword)return!0;i.value={status:!0,title:"กรุณาตรวจสอบ",body:"กรุณาตรวจสอบรหัสผ่าน"}},V=async()=>{if(I())if(v.value==="add"){const a={employeeID:s.value.in_employeeID,username:s.value.in_username,password:s.value.in_password,firstName:s.value.in_firstName,lastName:s.value.in_lastName,role:s.value.in_role};await x.create(a,async l=>{if(l.statusCode===200)i.value={status:!0,title:"สำเร็จ",body:"บันทึกข้อมูลสำเร็จ"},h(),await f();else{const y=l.message.map(w=>`<li>${w}</li>`);i.value={status:!0,title:"กรุณาตรวจสอบ",body:y.join("")}}})}else{const a={employeeID:s.value.in_employeeID,username:s.value.in_username,password:s.value.in_password,firstName:s.value.in_firstName,lastName:s.value.in_lastName,role:s.value.in_role};await x.update(a,r.value.username,async l=>{if(l.statusCode===200)i.value={status:!0,title:"สำเร็จ",body:"แก้ไขข้อมูลสำเร็จ"},h(),await f();else{const y=l.message.map(w=>`<li>${w}</li>`);i.value={status:!0,title:"กรุณาตรวจสอบ",body:y.join("")}}})}},h=()=>{document.getElementById("modal-employee").close()},$=()=>{i.value.status=!1},f=async()=>{const n={page:t.value.page,limit:t.value.limit};await x.search(n,a=>{c.value=a.data,t.value.totalPage=a.metadata.totalPage})},U=n=>{t.page=n,f()};return k(async()=>{M.commit("setStatusLoading",!0),await f(),g(),M.commit("setStatusLoading",!1)}),(n,a)=>(A(),j("div",null,[e("div",O,[e("div",T,[e("div",F,[H,e("div",K,[_(C,{label:"เพิ่มผู้ใช้งาน",icon:"plus",onClick:a[0]||(a[0]=l=>N("add"))})])]),e("div",R,[_(S,{columns:o,rows:c.value,rowEdit:!0,onOnClickEdit:D},null,8,["rows"])]),e("div",q,[_(L,{currentPage:t.value.page,"onUpdate:currentPage":[a[1]||(a[1]=l=>t.value.page=l),U],totalPages:t.value.totalPage,limit:t.value.limit},null,8,["currentPage","totalPages","limit"])])])]),e("dialog",G,[e("div",J,[e("h3",Q,B(v.value==="add"?"เพิ่มผู้ใช้งาน":"แก้ไขผู้ใช้งาน"),1),W,e("div",X,[e("div",Y,[Z,ee,u(e("input",{type:"text",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[2]||(a[2]=l=>s.value.in_employeeID=l)},null,512),[[p,s.value.in_employeeID]])]),e("div",se,[ae,le,u(e("input",{type:"text",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[3]||(a[3]=l=>s.value.in_firstName=l)},null,512),[[p,s.value.in_firstName]])]),e("div",te,[oe,ne,u(e("input",{type:"text",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[4]||(a[4]=l=>s.value.in_lastName=l)},null,512),[[p,s.value.in_lastName]])]),e("div",ie,[de,ue,u(e("input",{type:"text",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[5]||(a[5]=l=>s.value.in_username=l)},null,512),[[p,s.value.in_username]])]),e("div",re,[ce,me,u(e("input",{type:"password",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[6]||(a[6]=l=>s.value.in_password=l)},null,512),[[p,s.value.in_password]])]),e("div",_e,[pe,ve,u(e("input",{type:"password",class:"h-8 w-full focus:outline-red-400 rounded bg-red-100 px-3","onUpdate:modelValue":a[7]||(a[7]=l=>s.value.in_confirmPassword=l)},null,512),[[p,s.value.in_confirmPassword]])]),e("div",fe,[be,he,e("div",ye,[e("div",we,[u(e("input",{type:"radio",name:"role",value:"ผู้ดูแลระบบ",class:"radio radio-primary","onUpdate:modelValue":a[8]||(a[8]=l=>s.value.in_role=l)},null,512),[[P,s.value.in_role]]),xe]),e("div",ge,[u(e("input",{type:"radio",name:"role",value:"ผู้ใช้งาน",class:"radio radio-primary","onUpdate:modelValue":a[9]||(a[9]=l=>s.value.in_role=l)},null,512),[[P,s.value.in_role]]),Ne])])])]),e("div",Me,[_(C,{label:v.value=="add"?"เพิ่ม":"แก้ไข",onClick:V},null,8,["label"]),_(z,{label:"ปิด",onClick:h})])])]),_(E,{titleMessage:i.value.title,bodyMessage:i.value.body,status:i.value.status,onCloseAlertModal:$},null,8,["titleMessage","bodyMessage","status"])]))}};export{Ie as default};
